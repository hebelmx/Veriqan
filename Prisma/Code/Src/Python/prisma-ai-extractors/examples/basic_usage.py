"""
Basic usage examples for the modularized Prisma AI Extractors.
"""

from pathlib import Path
import sys

# Add src to path for local imports
sys.path.insert(0, str(Path(__file__).parent.parent / 'src'))

from api import PrismaExtractorAPI, quick_extract, compare_all_extractors
from factory import ExtractorFactory


def example_1_quick_extraction():
    """Example 1: Simple, one-line extraction."""
    print(\"\\n=== Example 1: Quick Extraction ===\")\n    \n    # Simple extraction (assumes you have an image)\n    image_path = \"sample_document.jpg\"  # Replace with actual path\n    \n    # One-line extraction\n    result = quick_extract(image_path, extractor='smolvlm')\n    \n    if result['success']:\n        print(f\"Extracted data: {result['data']}\")\n        print(f\"Processing time: {result['processing_time']:.2f}s\")\n    else:\n        print(f\"Extraction failed: {result['error']}\")\n\n\ndef example_2_api_usage():\n    \"\"\"Example 2: Using the full API with context manager.\"\"\"\n    print(\"\\n=== Example 2: API Usage ===\")\n    \n    image_path = \"sample_document.jpg\"  # Replace with actual path\n    \n    # Using context manager for automatic cleanup\n    with PrismaExtractorAPI() as api:\n        # Extract with different extractors\n        smol_result = api.extract(image_path, 'smolvlm')\n        paddle_result = api.extract(image_path, 'paddle')\n        \n        print(f\"SmolVLM result: {smol_result['success']}\")\n        print(f\"PaddleOCR result: {paddle_result['success']}\")\n        \n        # Get performance statistics\n        performance = api.get_performance_report()\n        print(f\"Total operations: {performance['api_level']['summary']['total_operations']}\")\n\n\ndef example_3_factory_pattern():\n    \"\"\"Example 3: Using the factory pattern for more control.\"\"\"\n    print(\"\\n=== Example 3: Factory Pattern ===\")\n    \n    # Create factory with custom configuration\n    config = {\n        'extractors': {\n            'smolvlm': {\n                'max_new_tokens': 256,\n                'temperature': 0.0\n            }\n        }\n    }\n    \n    factory = ExtractorFactory(config)\n    \n    # Create specific extractor\n    extractor = factory.create_extractor('smolvlm')\n    \n    # Use extractor directly\n    image_path = \"sample_document.jpg\"  # Replace with actual path\n    result = extractor.extract(image_path)\n    \n    print(f\"Direct extractor result: {result.success}\")\n    if result.success:\n        print(f\"Data: {result.document.structured_data}\")\n    \n    # Get detailed device info\n    device_info = extractor.device_info\n    print(f\"Using device: {device_info.get('device')}\")\n    \n    # Cleanup when done\n    extractor.cleanup()\n\n\ndef example_4_batch_processing():\n    \"\"\"Example 4: Batch processing multiple images.\"\"\"\n    print(\"\\n=== Example 4: Batch Processing ===\")\n    \n    # Multiple image paths\n    image_paths = [\n        \"doc1.jpg\",\n        \"doc2.jpg\", \n        \"doc3.jpg\"\n    ]  # Replace with actual paths\n    \n    with PrismaExtractorAPI() as api:\n        # Batch extraction\n        results = api.extract_batch(image_paths, 'smolvlm')\n        \n        # Process results\n        successful = [r for r in results if r['success']]\n        failed = [r for r in results if not r['success']]\n        \n        print(f\"Successful extractions: {len(successful)}/{len(results)}\")\n        print(f\"Failed extractions: {len(failed)}\")\n        \n        # Show performance stats\n        performance = api.get_performance_report()\n        avg_time = performance['api_level']['summary'].get('total_time', 0) / len(results)\n        print(f\"Average processing time: {avg_time:.2f}s\")\n\n\ndef example_5_extractor_comparison():\n    \"\"\"Example 5: Compare different extractors on same image.\"\"\"\n    print(\"\\n=== Example 5: Extractor Comparison ===\")\n    \n    image_path = \"sample_document.jpg\"  # Replace with actual path\n    \n    # Compare all available extractors\n    results = compare_all_extractors(image_path)\n    \n    for extractor_name, result in results.items():\n        status = \"✓\" if result['success'] else \"✗\"\n        time_taken = result.get('processing_time', 0)\n        print(f\"{status} {extractor_name}: {time_taken:.2f}s\")\n        \n        if result['success']:\n            data = result['data']\n            print(f\"  Data keys: {list(data.keys())}\")\n\n\ndef example_6_modular_components():\n    \"\"\"Example 6: Using individual modules for custom workflows.\"\"\"\n    print(\"\\n=== Example 6: Individual Modules ===\")\n    \n    from modules import ImageProcessor, JsonParser, DocumentValidator\n    \n    # Use modules individually\n    image_processor = ImageProcessor()\n    json_parser = JsonParser()\n    validator = DocumentValidator()\n    \n    image_path = \"sample_document.jpg\"  # Replace with actual path\n    \n    try:\n        # Process image\n        image = image_processor.load_image(image_path)\n        print(f\"Loaded image: {image.size}\")\n        \n        # Preprocess for OCR\n        processed_image = image_processor.preprocess_for_ocr(\n            image, \n            enhance_contrast=True\n        )\n        print(\"Applied OCR preprocessing\")\n        \n        # Parse some JSON text (example)\n        json_text = '{\"fecha\": \"2024-01-15\", \"autoridad\": \"CONDUSEF\"}'\n        parsed_data = json_parser.parse(json_text)\n        print(f\"Parsed JSON: {parsed_data}\")\n        \n        # Validate the data\n        is_valid, validated_data, errors = validator.validate(parsed_data)\n        print(f\"Validation result: {is_valid}\")\n        if errors:\n            print(f\"Validation errors: {errors}\")\n            \n    except Exception as e:\n        print(f\"Error in modular workflow: {e}\")\n\n\ndef example_7_custom_configuration():\n    \"\"\"Example 7: Custom configuration and error handling.\"\"\"\n    print(\"\\n=== Example 7: Custom Configuration ===\")\n    \n    from modules import ConfigManager, ErrorHandler\n    \n    # Create custom configuration\n    config_manager = ConfigManager()\n    config_manager.set('extractors.smolvlm.max_new_tokens', 128)\n    config_manager.set('processing.timeout', 60)\n    config_manager.set('validation.strict_mode', True)\n    \n    # Setup error handling\n    error_handler = ErrorHandler()\n    \n    # Create API with custom config\n    config_dict = config_manager.to_dict()\n    \n    with PrismaExtractorAPI(config_dict) as api:\n        image_path = \"sample_document.jpg\"  # Replace with actual path\n        \n        result = api.extract(image_path, 'smolvlm')\n        \n        if result['success']:\n            print(\"Extraction successful with custom config\")\n        else:\n            print(f\"Extraction failed: {result['error']}\")\n        \n        # Check error statistics\n        error_stats = api.get_error_statistics()\n        print(f\"API errors: {error_stats['api_level']['total_errors']}\")\n\n\nif __name__ == \"__main__\":\n    print(\"Prisma AI Extractors - Modular Usage Examples\")\n    print(\"=\" * 50)\n    \n    # Note: These examples assume you have actual image files\n    # Replace \"sample_document.jpg\" with real image paths\n    \n    try:\n        example_1_quick_extraction()\n    except Exception as e:\n        print(f\"Example 1 failed: {e}\")\n    \n    try:\n        example_2_api_usage()\n    except Exception as e:\n        print(f\"Example 2 failed: {e}\")\n    \n    try:\n        example_3_factory_pattern()\n    except Exception as e:\n        print(f\"Example 3 failed: {e}\")\n    \n    try:\n        example_4_batch_processing()\n    except Exception as e:\n        print(f\"Example 4 failed: {e}\")\n    \n    try:\n        example_5_extractor_comparison()\n    except Exception as e:\n        print(f\"Example 5 failed: {e}\")\n    \n    try:\n        example_6_modular_components()\n    except Exception as e:\n        print(f\"Example 6 failed: {e}\")\n    \n    try:\n        example_7_custom_configuration()\n    except Exception as e:\n        print(f\"Example 7 failed: {e}\")\n    \n    print(\"\\nExamples completed!\")
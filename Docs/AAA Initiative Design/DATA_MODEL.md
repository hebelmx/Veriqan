# Unified Data Model for ExxerCube Prisma

**Version:** 1.0
**Date:** November 2025
**Purpose:** This document defines the central "Unified Requirement" data model. This model represents the structured, cleaned, and reconciled data produced by the Prisma system after processing incoming authority requirements. It is the primary data object used for storage, reporting, and downstream processing.

---

## 1. Data Model Principles

- **Comprehensive:** Includes all 42 mandatory fields for the R29 report, plus internal metadata for auditing and processing.
- **Structured:** Flattens complex requests into a clear, relational structure.
- **Traceable:** Every field includes metadata about its source (e.g., XML, OCR, manual) and confidence level.
- **Action-Oriented:** Directly supports the generation of the R29 report and the detailed "5 Situations" summary for legal review.

---

## 2. Unified Requirement Data Structure

This model is the target output of the `Data Fusion & Confidence Engine`.

### 2.1. Core Identification & Tracking

| Field Name | Data Type | Example | Source / Logic | R29 Col |
| :--- | :--- | :--- | :--- | :--- |
| `InternalCaseId` | GUID | `b8f3c...` | Generated by Prisma on intake. | N/A |
| `CnbvExpedienteId` | String | `A/AS1-2505-088637-PHM` | From XML `<Cnbv_NumeroExpediente>` or OCR. | N/A |
| `NumeroOficio` | String | `214-1-18714972/2025` | From XML `<Cnbv_NumeroOficio>` or OCR. | 7, 36 |
| `SiaraFolio` | String | `123456789012345678/2025/123456` | From XML or OCR. | 9, 38 |
| `SourceAuthorityName` | String | `ADMINISTRACION GENERAL DE AUDITORIA FISCAL FEDERAL` | From Authority Catalog lookup. | 6 |
| `SourceAuthorityCode` | String | `SAT-AGAF` | From Authority Catalog lookup. | 5 |
| `ReceptionTimestamp` | DateTime | `2025-11-30T14:30:00Z` | Timestamp of file download. | 8, 37 |
| `ProcessingStatus` | String | `Completed_Auto` | `Received`, `InReview`, `Completed_Auto`, `Completed_Manual`, `Rejected` | N/A |

### 2.2. SLA & Classification

| Field Name | Data Type | Example | Source / Logic | R29 Col |
| :--- | :--- | :--- | :--- | :--- |
| `SlaDays` | Integer | `10` | From XML `<Cnbv_DiasPlazo>` or OCR. | N/A |
| `SlaDueDate` | DateTime | `2025-12-10T15:00:00Z` | Calculated: `ReceptionTimestamp` + `SlaDays` (business days). | N/A |
| `RequirementType` | String | `Aseguramiento` | From `ClassificationRules.md`. | 35 |
| `RequirementTypeCode` | Integer | `101` | From `ClassificationRules.md`. | 35 |
| `Subdivision` | String | `A/AS Especial Aseguramiento` | From XML `<Cnbv_AreaDescripcion>` or OCR. | N/A |

### 2.3. Subject & Account Holder Information

This section may be a list to support multiple subjects in a single requirement.

| Field Name | Data Type | Example | Source / Logic | R29 Col |
| :--- | :--- | :--- | :--- | :--- |
| `IsPrimaryTitular` | Boolean | `true` | First subject listed is primary. | N/A |
| `LegalPersonality` | String | `Persona Física` | `1` -> "Persona Física", `2` -> "Persona Moral". | 11, 18 |
| `Character` | String | `IND` (Indiciado) | From `ClassificationRules.md` keyword matching. | 12, 19 |
| `RFC` | String | `GARC123456XYZ` | From XML `<Rfc>` or OCR. Validated format. | 13, 20 |
| `FullName` | String | `EUGENIO GARCIA ZAVALA` | Concatenated from `Nombre`, `Paterno`, `Materno`. | 14-17, 21-24 |
| `Address` | String | `CALLE R/A JOLOCHERO...` | From XML `<Domicilio>` or OCR. | N/A |

### 2.4. Financial Information (R29 Report Data)

| Field Name | Data Type | Example | Source / Logic | R29 Col |
| :--- | :--- | :--- | :--- | :--- |
| `BranchCode` | String | `0123` | From bank's internal systems post-lookup. | 25 |
| `StateINEGI` | Integer | `27` | From bank's internal systems post-lookup. | 26 |
| `AccountNumber` | String | `9876543210` | From XML or OCR. | 31 |
| `ProductType` | Integer | `101` (Depósito a la Vista) | From bank's internal systems post-lookup. | 32 |
| `Currency` | String | `MXN` | `0` -> "MXN", `1` -> "USD", `2` -> "Other". | 33, 41 |
| `InitialBlockedAmount` | Decimal | `50000.00` | Amount blocked at execution. Converted to MXN. | 34 |
| `OperationAmount` | Decimal | `50000.00` | Amount of the specific operation (unblock, transfer). | 40 |
| `FinalBalance` | Decimal | `1500.50` | Balance after operation. | 42 |

### 2.5. Semantic Analysis (The "5 Situations")

This structure is the output of the `Semantic Analysis & Action Formulation` component and is critical for the legal team's review.

```json
{
  "semantic_analysis": {
    "requiere_bloqueo": {
      "es_requerido": true,
      "is_parcial": false,
      "monto": 50000.00,
      "moneda": "MXN",
      "cuentas_especificas": ["9876543210"],
      "productos_especificos": ["Cuenta de Ahorro"]
    },
    "requiere_desbloqueo": {
      "es_requerido": false,
      "expediente_bloqueo_original": null
    },
    "requiere_documentacion": {
      "es_requerido": true,
      "tipos_documento": [
        { "tipo": "Estado de cuenta", "periodo_inicio": "2024-01-01", "periodo_fin": "2024-12-31" },
        { "tipo": "ID del cliente" }
      ]
    },
    "requiere_transferencia": {
      "es_requerido": false
    },
    "requiere_informacion_general": {
      "es_requerido": false,
      "informacion_solicitada": null
    }
  }
}
```

### 2.6. Processing & Confidence Metadata

| Field Name | Data Type | Example | Purpose |
| :--- | :--- | :--- | :--- |
| `SourceFilePaths` | List[str] | `["oficio.pdf", "oficio.xml"]` | Links to original downloaded files. |
| `ProcessingLog` | List[str] | `["Downloaded", "OCR Applied", "Reconciled"]` | High-level audit trail. |
| `FieldConfidence` | Dict | `{"RFC": {"source": "XML", "score": 1.0}}` | Per-field traceability and confidence score. |
| `IsFlaggedForReview` | Boolean | `true` | Indicates if case requires manual intervention. |
| `ReviewReason` | String | `Conflict found in Subject Name.` | Justification for manual review flag. |

---

## 3. Enumerations and Catalogs

The model relies on several key enumerations and catalogs, which must be managed and versioned.

- **Authority Catalog:** (See `ENTITY_SOURCES_CATALOG.md`) Used to validate and classify the requesting authority.
- **Requirement Types:** (100-104, etc.) Defined in `ClassificationRules.md`.
- **Subject Character Types:** (CON, IND, IMP) Defined in R29 Instructivo and `ClassificationRules.md`.
- **Financial Product Types:** (1, 13, 101, etc.) Defined in R29 Instructivo.
- **Geographic Catalogs:** (INEGI codes) Sourced from INEGI.

By centralizing this data definition, all components of the Prisma system—from extraction to reconciliation to reporting—can operate on a consistent, reliable, and predictable data structure.
